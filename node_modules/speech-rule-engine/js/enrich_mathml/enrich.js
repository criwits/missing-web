"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.prepareMmlString = exports.testTranslation__ = exports.semanticMathml = exports.semanticMathmlSync = exports.semanticMathmlNode = void 0;
const debugger_1 = require("../common/debugger");
const DomUtil = require("../common/dom_util");
const engine_1 = require("../common/engine");
const Semantic = require("../semantic_tree/semantic");
const EnrichMathml = require("./enrich_mathml");
const enrich_attr_1 = require("./enrich_attr");
require("./enrich_case_factory");
function semanticMathmlNode(mml) {
    const clone = mml.cloneNode(true);
    const tree = Semantic.getTree(clone);
    return EnrichMathml.enrich(clone, tree);
}
exports.semanticMathmlNode = semanticMathmlNode;
function semanticMathmlSync(expr) {
    const mml = DomUtil.parseInput(expr);
    return semanticMathmlNode(mml);
}
exports.semanticMathmlSync = semanticMathmlSync;
function semanticMathml(expr, callback) {
    engine_1.EnginePromise.getall().then(() => {
        const mml = DomUtil.parseInput(expr);
        callback(semanticMathmlNode(mml));
    });
}
exports.semanticMathml = semanticMathml;
function testTranslation__(expr) {
    debugger_1.Debugger.getInstance().init();
    const mml = semanticMathmlSync(prepareMmlString(expr)).toString();
    (0, enrich_attr_1.removeAttributePrefix)(mml);
    debugger_1.Debugger.getInstance().exit();
    return mml;
}
exports.testTranslation__ = testTranslation__;
function prepareMmlString(expr) {
    if (!expr.match(/^<math/)) {
        expr = '<math>' + expr;
    }
    if (!expr.match(/\/math>$/)) {
        expr += '</math>';
    }
    return expr;
}
exports.prepareMmlString = prepareMmlString;
